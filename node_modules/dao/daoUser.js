
	exports.create = function(mongo) {
		
		mongo.connect('mongodb://localhost/db_meworls');
		
		var	Schema		= mongo.Schema,
			ObjectId	= Schema.ObjectId;
			
		var userSchema	= new Schema({
			id			: ObjectId,
			name		: String,
			nick		: String,
			chrId		: String,
			email		: String,
			pass		: String,
			positionY	: Number,
			positionX	: Number
		});
		
		var User = mongo.model('User',userSchema);
		
		return {
			insert: function(req,res) {
				var user = new User();
				
				user.name			= req.body.name;
				user.nick			= req.body.nick;
				user.chrId			= req.body.chrId;
				user.email			= req.body.email;
				user.pass			= req.body.pass;
				user.positionY		= 0;
				user.positionX		= 0;
				
				user.save(function() {
					console.log("SALVOOOOOOOOOOOOOOOOO");
					
					res.redirect('/');
				});
			},
			
			selectLogin: function(req,res,socket,daoChr) {
				var email	= req.body.email,
					pass	= req.body.pass;

				//var email	= "paivasm@hotmail.com";//req.body.email,
				//	pass	= "123";//req.body.pass;

				User.findOne({"email" : email}, function(err, user) {
									
					if(pass === user.pass) {
						var Chr = daoChr.getModel();
						
						Chr.findOne({"_id" : user.chrId}, function(err, chr) {
							
							if(chr) {

								socket.getColl({user: user,chr: chr});
								res.render('join',{ title: 'meWorls' });

							} else {
								
								res.render('login',{ title: 'meWorls' });
								
							}
							
						});
						
					} else {
						
						res.render('login',{ title: 'meWorls' });
						
					}
				});
			},

			selectUpdate: function(req,res) {

			},

			update: function(req,res) {
		 	
			}
		}
	}